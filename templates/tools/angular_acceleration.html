{% extends "base.html" %}
{% import "partials/macros.html" as macros %}

{% block title %}角加速度计算 - 电机电力电气计算工具站{% endblock %}

{% set schema = {
    "apiPath": "/api/tools/angular-acceleration/calculate",
    "tabs": [
        {
            "id": "acceleration_time",
            "tab_label": "加速时间计算",
            "scenario": "acceleration_time",
            "section": {
                "id": "acceleration_time",
                "title": "加速时间计算",
                "descriptions": [
                    "加速时间: t<sub>0</sub> = t × A"
                ],
                "fields": [
                    {
                        "id": "at_t",
                        "name": "t",
                        "label": "每次定位时间 t",
                        "unit": "s",
                        "step": 0.1,
                        "min": 0.1,
                        "default": 1.5,
                        "placeholder": "例如: 1.5",
                        "required": true
                    },
                    {
                        "id": "at_A",
                        "name": "A",
                        "label": "加减速时间比 A",
                        "step": 0.01,
                        "min": 0.01,
                        "max": 0.99,
                        "default": 0.5,
                        "placeholder": "例如: 0.5",
                        "required": true,
                        "help": "通常在0.25~0.5之间"
                    }
                ],
                "result": {
                    "id": "at_result",
                    "formula_id": "at_result_formula",
                    "items": [
                        {"id": "at_t0_value", "label": "加速时间 t<sub>0</sub>", "unit": "s", "source": "result", "decimals": 4}
                    ]
                }
            }
        },
        {
            "id": "motor_speed",
            "tab_label": "电机转速计算",
            "scenario": "motor_speed",
            "section": {
                "id": "motor_speed",
                "title": "电机转速计算",
                "descriptions": [
                    "减速机输出轴角加速度: β = (L×π)/(180×(t<sub>0</sub>×(t-t<sub>0</sub>)))",
                    "减速机输出轴转速: N<sub>max</sub> = (β×t<sub>0</sub>/(2×π))×60",
                    "电机输出轴角加速度: β<sub>M</sub> = i × β",
                    "电机输出轴转速: N<sub>M</sub> = N<sub>max</sub> × i"
                ],
                "fields": [
                    {"id": "ms_i", "name": "i", "label": "减速比 i", "step": 0.1, "min": 0.1, "default": 5, "placeholder": "例如: 5", "required": true},
                    {"id": "ms_t", "name": "t", "label": "每次定位时间 t", "unit": "s", "step": 0.1, "min": 0.1, "default": 1.5, "placeholder": "例如: 1.5", "required": true},
                    {"id": "ms_L", "name": "L", "label": "每次运动角度 L", "unit": "°", "step": 0.1, "min": 0.1, "default": 15, "placeholder": "例如: 15", "required": true},
                    {"id": "ms_A", "name": "A", "label": "加减速时间比 A", "step": 0.01, "min": 0.01, "max": 0.99, "default": 0.5, "placeholder": "例如: 0.5", "required": true, "help": "通常在0.25~0.5之间"}
                ],
                "result": {
                    "id": "ms_result",
                    "formula_id": "ms_result_formula",
                    "items": [
                        {"id": "ms_t0_value", "label": "加速时间 t<sub>0</sub>", "unit": "s", "source": "extra.t0", "decimals": 4},
                        {"id": "ms_beta_value", "label": "减速机输出轴角加速度 β", "unit": "rad/s²", "source": "extra.beta", "decimals": 6},
                        {"id": "ms_Nmax_value", "label": "减速机输出轴转速 N<sub>max</sub>", "unit": "rpm", "source": "extra.Nmax", "decimals": 4},
                        {"id": "ms_betaM_value", "label": "电机输出轴角加速度 β<sub>M</sub>", "unit": "rad/s²", "source": "extra.betaM", "decimals": 6},
                        {"id": "ms_NM_value", "label": "电机输出轴转速 N<sub>M</sub>", "unit": "rpm", "source": "result", "decimals": 4}
                    ]
                }
            }
        },
        {
            "id": "torque",
            "tab_label": "扭矩计算",
            "scenario": "torque",
            "section": {
                "id": "torque",
                "title": "扭矩计算",
                "descriptions": [
                    "电机输出扭矩: T = J × β<sub>M</sub>",
                    "启动扭矩: T<sub>s</sub> = 2 × T"
                ],
                "fields": [
                    {"id": "tq_J", "name": "J", "label": "负载惯量 J", "unit": "Kg.m²", "step": 0.001, "min": 0.001, "default": 0.285, "placeholder": "例如: 0.285", "required": true},
                    {"id": "tq_betaM", "name": "betaM", "label": "电机输出轴角加速度 β<sub>M</sub>", "unit": "rad/s²", "step": 0.000001, "min": 0.000001, "default": 2.327106, "placeholder": "例如: 2.327106", "required": true, "help": "可从\"电机转速计算\"标签页获得"}
                ],
                "result": {
                    "id": "tq_result",
                    "formula_id": "tq_result_formula",
                    "items": [
                        {"id": "tq_T_value", "label": "电机输出扭矩 T", "unit": "Nm", "source": "extra.T", "decimals": 6},
                        {"id": "tq_result_value", "label": "启动扭矩 T<sub>s</sub>", "unit": "Nm", "source": "result", "decimals": 6}
                    ]
                }
            }
        }
    ]
} %}

{% block content %}
<div class="page-header">
    <h1>角加速度计算</h1>
    <p class="subtitle">根据运动要求计算最大转速、角加速度与扭矩，统一使用API计算，前端配置化渲染表单与结果。</p>
</div>

<div class="reference-table" style="background: #e8f5e9; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem; border: 1px solid #c8e6c9;">
    <div style="display: grid; grid-template-columns: 1fr 4px 1fr 4px 1fr; gap: 1rem; align-items: start;">
        <div>
            <h3 style="color: #2c3e50; margin-bottom: 1rem; font-size: 1.1rem; font-weight: 600;">核心符号</h3>
            <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                <tr><td style="padding: 0.3rem 0;">i</td><td style="padding: 0.3rem 0;">减速比</td></tr>
                <tr><td style="padding: 0.3rem 0;">t</td><td style="padding: 0.3rem 0;">每次定位时间(s)</td></tr>
                <tr><td style="padding: 0.3rem 0;">L</td><td style="padding: 0.3rem 0;">每次运动角度(°)</td></tr>
            </table>
        </div>
        <div style="background: #4caf50; width: 2px; height: 100%; border-radius: 1px;"></div>
        <div>
            <h3 style="color: #2c3e50; margin-bottom: 1rem; font-size: 1.1rem; font-weight: 600;">结果含义</h3>
            <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                <tr><td style="padding: 0.3rem 0;">t<sub>0</sub></td><td style="padding: 0.3rem 0;">加速时间</td></tr>
                <tr><td style="padding: 0.3rem 0;">β/β<sub>M</sub></td><td style="padding: 0.3rem 0;">输出轴角加速度/电机轴角加速度</td></tr>
                <tr><td style="padding: 0.3rem 0;">N<sub>max</sub>/N<sub>M</sub></td><td style="padding: 0.3rem 0;">输出轴/电机轴最大转速</td></tr>
                <tr><td style="padding: 0.3rem 0;">T/T<sub>s</sub></td><td style="padding: 0.3rem 0;">电机输出扭矩/启动扭矩</td></tr>
            </table>
        </div>
        <div style="background: #4caf50; width: 2px; height: 100%; border-radius: 1px;"></div>
        <div>
            <h3 style="color: #2c3e50; margin-bottom: 1rem; font-size: 1.1rem; font-weight: 600;">使用提示</h3>
            <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                <tr><td style="padding: 0.3rem 0;">A</td><td style="padding: 0.3rem 0;">加减速时间比，常用0.25~0.5</td></tr>
                <tr><td style="padding: 0.3rem 0;">J</td><td style="padding: 0.3rem 0;">负载惯量，单位Kg·m²</td></tr>
            </table>
        </div>
    </div>
    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #c8e6c9; text-align: right;">
        <span style="color: #e74c3c; font-size: 0.9rem; font-weight: 500;">注: *为必填项</span>
    </div>
</div>

<div class="sub-tabs-container">
    <div id="sub-tabs-angular" class="sub-tabs active">
        {% for tab in schema.tabs %}
            <button class="sub-tab{% if loop.first %} active{% endif %}" data-target="{{ tab.id }}">{{ loop.index }}. {{ tab.tab_label }}</button>
        {% endfor %}
    </div>
</div>

{% for tab in schema.tabs %}
<div id="{{ tab.id }}" class="tab-content{% if loop.first %} active{% endif %}" data-scenario="{{ tab.scenario }}">
    {{ macros.form_section(tab.section) }}
</div>
{% endfor %}

<script>
    const angularAccelerationSchema = {{ schema | tojson }};
</script>
<script src="{{ static_asset('js/tools/angular_acceleration.js') }}"></script>
{% endblock %}

